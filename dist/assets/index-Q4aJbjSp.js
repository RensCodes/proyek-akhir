(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const S="modulepreload",L=function(e){return"/proyek-akhir/"+e},p={},l=function(r,t,o){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(u=>{if(u=L(u),u in p)return;p[u]=!0;const g=u.endsWith(".css"),w=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${w}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":S,g||(d.as="script"),d.crossOrigin="",d.href=u,i&&d.setAttribute("nonce",i),document.head.appendChild(d),g)return new Promise((v,E)=>{d.addEventListener("load",v),d.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return n.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return r().catch(s)})},h={API_BASE_URL:"https://story-api.dicoding.dev/v1",TILE_LAYERS:{OpenStreetMap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},SatelitEsri:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},GelapCartoDB:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}},DEFAULT_MAP_CENTER:[-2.5489,118.0149],DEFAULT_MAP_ZOOM:5},m={performViewTransition:e=>document.startViewTransition?document.startViewTransition(e):(e(),null),showMessage:(e,r,t=!1)=>{const o=document.getElementById("messageModal"),n=document.getElementById("messageModalTitle"),s=document.getElementById("messageModalText"),a=document.getElementById("messageModalClose");if(!o||!n||!s||!a){console.error("Modal elements not found for Utils.showMessage!"),alert(`${e}: ${r}`);return}n.textContent=e,n.className=`modal-title ${t?"modal-title-error":"modal-title-success"}`,t?n.style.color="#dc3545":n.style.color="#343a40",s.textContent=r,o.classList.add("active"),a.focus();const i=a.cloneNode(!0);i.textContent="Tutup",i.className="btn btn-primary modal-close-btn",a.parentNode.replaceChild(i,a),i.addEventListener("click",()=>o.classList.remove("active"),{once:!0})},showLoadingSpinner:(e,r="Memuat...")=>{if(!e)return null;e.innerHTML="";const t=m.createElement("div",{class:"loading-indicator-container"}),o=m.createElement("div",{class:"spinner","aria-label":"Loading indicator",role:"status"}),n=m.createElement("p",{class:"loading-text"},[r]);return t.append(o,n),e.appendChild(t),t},hideLoadingSpinner:e=>{if(!e)return;const r=e.querySelector(".loading-indicator-container");r&&r.remove()},createElement:(e,r={},t=[])=>{const o=document.createElement(e);for(const n in r)o.setAttribute(n,r[n]);return t.forEach(n=>{typeof n=="string"?o.appendChild(document.createTextNode(n)):n instanceof Node&&o.appendChild(n)}),o},async base64ToFile(e,r,t){try{const n=await(await fetch(e)).blob();return new File([n],r,{type:t||n.type})}catch(o){throw console.error("Error converting base64 to File:",o),new Error("Gagal memproses gambar.")}},formatDate(e){if(!e)return"Tanggal tidak diketahui";try{return new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error(`Gagal memformat tanggal: "${e}"`,r),e}}},y={async register(e){const r=await fetch(`${h.API_BASE_URL}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();if(r.status>=400||t.error)throw new Error(t.message||"Gagal melakukan registrasi");return t},async login(e){const r=await fetch(`${h.API_BASE_URL}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();if(r.status>=400||t.error)throw new Error(t.message||"Gagal melakukan login");return t.loginResult},async getStories(e){if(!e)return Promise.reject(new Error("Token tidak tersedia untuk mengambil cerita."));const r=await fetch(`${h.API_BASE_URL}/stories`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),t=await r.json();if(r.status>=400||t.error)throw new Error(t.message||"Gagal mengambil cerita");return t.listStory},async addStory(e,r){if(!e)return Promise.reject(new Error("Token tidak tersedia untuk menambah cerita."));const t=await fetch(`${h.API_BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r}),o=await t.json();if(t.status>=400||o.error)throw new Error(o.message||"Gagal menambah cerita baru");return o},async getStoryDetail(e,r){if(!e)return Promise.reject(new Error("Token tidak tersedia."));const t=await fetch(`${h.API_BASE_URL}/stories/${r}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),o=await t.json();if(t.status>=400||o.error)throw new Error(o.message||"Gagal mengambil detail cerita");return o.story}},f="storyAppToken",_="storyAppUserName",c={saveToken(e){localStorage.setItem(f,e)},getToken(){return localStorage.getItem(f)},removeToken(){localStorage.removeItem(f)},saveUserName(e){localStorage.setItem(_,e)},getUserName(){return localStorage.getItem(_)},removeUserName(){localStorage.removeItem(_)},isLoggedIn(){return!!this.getToken()}},A={async register(e,r,t){if(!e||!r||!t)throw new Error("Nama, email, dan password tidak boleh kosong.");if(t.length<8)throw new Error("Password minimal harus 8 karakter.");try{return await y.register({name:e,email:r,password:t})}catch(o){throw console.error("AuthModel.register error:",o),o}},async login(e,r){if(!e||!r)throw new Error("Email dan password tidak boleh kosong.");try{const t=await y.login({email:e,password:r});return c.saveToken(t.token),c.saveUserName(t.name),t}catch(t){throw console.error("AuthModel.login error:",t),c.removeToken(),c.removeUserName(),t}},logout(){c.removeToken(),c.removeUserName(),console.log("Pengguna berhasil logout dari AuthModel.")},isUserLoggedIn(){return c.isLoggedIn()},getCurrentUserName(){return c.getUserName()},getCurrentToken(){return c.getToken()}},T={_routes:{},_currentPresenter:null,_mainContentElement:null,_authModel:A,_storyModel:null,_authView:null,_homeView:null,_addStoryView:null,_mapService:null,_cameraService:null,async init(e){if(this._mainContentElement=document.getElementById(e),!this._mainContentElement){console.error(`Router init: Elemen konten utama dengan ID '${e}' tidak ditemukan.`);return}const{default:r}=await l(async()=>{const{default:n}=await import("./AuthView-CF9w7hvF.js");return{default:n}},[]);this._authView=r,this._authView.mainContent=this._mainContentElement;const{default:t}=await l(async()=>{const{default:n}=await import("./MapService-CF3nIhqQ.js");return{default:n}},[]);this._mapService=t;const{default:o}=await l(async()=>{const{default:n}=await import("./CameraService-CyfgTUCH.js");return{default:n}},[]);this._cameraService=o,this._routes={login:async()=>this._buildAuthPresenter("login"),register:async()=>this._buildAuthPresenter("register"),home:async()=>this._buildHomePresenter(),"add-story":async()=>this._buildAddStoryPresenter(),logout:()=>this._handleLogoutRoute()},window.addEventListener("hashchange",this._handleRouteChange.bind(this)),this._handleRouteChange(),this._setupGlobalNavLinks(),this._updateNavbar()},async _buildAuthPresenter(e="login"){const{default:r}=await l(async()=>{const{default:o}=await import("./AuthPresenter-CfdIpfJ1.js");return{default:o}},[]),t=r(this._authModel,this._authView,this);return e==="login"?t.showLoginPage():t.showRegisterPage(),t},async _buildHomePresenter(){if(!this._authModel.isUserLoggedIn())return this.navigateTo("login"),null;if(!this._homeView){const{default:t}=await l(async()=>{const{default:o}=await import("./HomeView-BONIZ4-d.js");return{default:o}},[]);this._homeView=t,this._homeView.mainContent=this._mainContentElement}if(!this._storyModel){const{default:t}=await l(async()=>{const{default:o}=await import("./StoryModel-CdXE3PEQ.js");return{default:o}},[]);this._storyModel=t}const{default:e}=await l(async()=>{const{default:t}=await import("./HomePresenter-ChwXqAny.js");return{default:t}},[]),r=e(this._storyModel,this._authModel,this._homeView,this,this._mapService);return await r.showStories(),this._updateNavbar(),r},async _buildAddStoryPresenter(){if(!this._authModel.isUserLoggedIn())return this.navigateTo("login"),null;if(!this._addStoryView){const{default:t}=await l(async()=>{const{default:o}=await import("./AddStoryView-IPsh5vaf.js");return{default:o}},[]);this._addStoryView=t,this._addStoryView.mainContent=this._mainContentElement}if(!this._storyModel){const{default:t}=await l(async()=>{const{default:o}=await import("./StoryModel-CdXE3PEQ.js");return{default:o}},[]);this._storyModel=t}const{default:e}=await l(async()=>{const{default:t}=await import("./AddStoryPresenter-Cy-DCv_O.js");return{default:t}},[]),r=e(this._storyModel,this._addStoryView,this,this._mapService,this._cameraService,m);return r.showAddStoryForm(),this._updateNavbar(),r},_handleLogoutRoute(){return this._currentPresenter&&typeof this._currentPresenter.destroy=="function"&&(this._currentPresenter.destroy(),this._currentPresenter=null),this._authModel.logout(),m.showMessage("Logout Berhasil","Anda telah berhasil keluar."),this.navigateTo("login"),this._updateNavbar(),null},async _handleRouteChange(){const e=window.location.hash.slice(1)||(this._authModel.isUserLoggedIn()?"home":"login");let r=e.split("/")[0];const t=e.split("/").slice(1),o=["home","add-story"],n=["login","register"];if(o.includes(r)&&!this._authModel.isUserLoggedIn()){this.navigateTo("login");return}if(n.includes(r)&&this._authModel.isUserLoggedIn()){this.navigateTo("home");return}this._routes[r]||(r=this._authModel.isUserLoggedIn()?"home":"login"),this._currentPresenter&&typeof this._currentPresenter.destroy=="function"&&(this._currentPresenter.destroy(),this._currentPresenter=null);const s=this._routes[r];if(typeof s=="function"){const a=async()=>{this._currentPresenter=await s(t)};document.startViewTransition?document.startViewTransition(a):await a(),this._updateActiveNavLink(r),this._mainContentElement&&typeof this._mainContentElement.focus=="function"&&this._mainContentElement.focus()}else console.error(`Router: Tidak ada fungsi untuk membuat presenter untuk rute '${r}'`),this._mainContentElement&&(this._mainContentElement.innerHTML='<div class="error-page-container"><p class="error-message">Error: Halaman tidak ditemukan.</p></div>'),this._updateActiveNavLink("");this._updateNavbar()},navigateTo(e){window.location.hash.slice(1).split("/")[0]!==e||window.location.hash.slice(1)!==e?window.location.hash=e:this._handleRouteChange()},_setupGlobalNavLinks(){const e=document.querySelector("#app-header .nav-container");e&&e.addEventListener("click",r=>{const t=r.target.closest("a[data-route]");if(t){r.preventDefault();const o=t.dataset.route;o&&this.navigateTo(o)}})},_updateActiveNavLink(e){document.querySelectorAll("#nav-links-container .nav-link").forEach(r=>{r.dataset.route===e?r.classList.add("active"):r.classList.remove("active")})},_updateNavbar(){const e=document.getElementById("nav-links-container");if(!e)return;const r=this._authModel.isUserLoggedIn(),t=this._authModel.getCurrentUserName();let o="";r?o=`
                <li><a href="#home" class="nav-link" data-route="home"><i class="fas fa-home"></i>Beranda</a></li>
                <li><a href="#add-story" class="nav-link" data-route="add-story"><i class="fas fa-plus-circle"></i>Tambah Cerita</a></li>
                <li><a href="#logout" class="nav-link" data-route="logout"><i class="fas fa-sign-out-alt"></i>Logout (${t||"User"})</a></li>
            `:o=`
                <li><a href="#login" class="nav-link" data-route="login"><i class="fas fa-sign-in-alt"></i>Login</a></li>
                <li><a href="#register" class="nav-link" data-route="register"><i class="fas fa-user-plus"></i>Register</a></li>
            `,e.innerHTML=o;const n=window.location.hash.slice(1)||(r?"home":"login");this._updateActiveNavLink(n.split("/")[0])}};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("currentYear");e&&(e.textContent=new Date().getFullYear()),T.init("main-content"),console.log("StoryVerse App (Custom CSS & MVP) Loaded!")});export{h as C,y as S,c as T,m as U};
