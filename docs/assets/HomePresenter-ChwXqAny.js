import{_ as u}from"./index-CiRWjb8D.js";function v(y,p,n,f,g){const s={_storyModel:y,_authModel:p,_homeView:n,_router:f,_mapService:g,async showStories(){var c,h,m,_;this._homeView.renderLoading();let e=[],a=!1;try{const o=window._storyDataDirty||!1;e=await this._storyModel.fetchStories(o),window._storyDataDirty=!1}catch(o){console.warn("Gagal fetch online, mencoba offline DB:",o);try{e=await this._storyModel.getAllStoriesFromDb(),a=!0}catch(w){console.error("Gagal ambil dari IndexedDB:",w),this._homeView.renderError("Gagal memuat cerita, dan tidak ada data offline.");return}}const r=((h=(c=this._authModel).getCurrentUserName)==null?void 0:h.call(c))||"Pengguna",i=Array.isArray(e)?e:[];this._homeView.renderStories(i,r);const t=(_=(m=this._homeView).getMapContainerId)==null?void 0:_.call(m),l=i.filter(o=>o.lat&&o.lon),d=document.getElementById(t);d&&(l.length>0?this._mapService.initDisplayMap(t,l):d.innerHTML='<p class="no-map-data-message">Peta akan muncul di sini jika ada cerita dengan data lokasi.</p>'),a&&console.warn("[HomePresenter] Cerita ditampilkan dari cache offline.")},async handleDeleteStory(e){try{await this._storyModel.deleteStoryFromDb(e),window._storyDataDirty=!0,await this.showStories()}catch(a){console.error("Gagal menghapus cerita dari beranda:",a),alert("Gagal menghapus cerita dari beranda.")}},handleViewOnMap({lat:e,lon:a,title:r}){var i;if(console.log(`HomePresenter: Menampilkan lokasi untuk ${r} di peta: ${e}, ${a}`),(i=this._mapService)!=null&&i.panToLocation){this._mapService.panToLocation(e,a);const t=document.getElementById(this._homeView.getMapContainerId());t==null||t.scrollIntoView({behavior:"smooth",block:"center"})}},navigateToAddStoryPage(){this._router.navigateTo("add-story")},async handleSaveStory(e){var a;try{if(await u(()=>import("./DbService-BL4Dz8du.js"),[]).then(t=>t.default.isStorySaved(e))){alert("Cerita ini sudah tersimpan sebelumnya.");return}const i=(a=this._storyModel._storiesCache)==null?void 0:a.find(t=>t.id===e);if(!i){alert("Cerita tidak ditemukan atau belum dimuat.");return}await u(()=>import("./DbService-BL4Dz8du.js"),[]).then(t=>t.default.saveStoryToSaved(i)),alert("Cerita berhasil disimpan ke daftar tersimpan.")}catch(r){console.error("Gagal menyimpan cerita:",r),alert("Terjadi kesalahan saat menyimpan cerita.")}},destroy(){var e,a,r,i;(a=(e=this._homeView)==null?void 0:e.destroy)==null||a.call(e),(i=(r=this._mapService)==null?void 0:r.destroyDisplayMap)==null||i.call(r),this._storyModel=null,this._authModel=null,this._homeView=null,this._router=null,this._mapService=null,console.log("HomePresenter instance dihancurkan.")}};return n.setPresenter(s),s}export{v as default};
