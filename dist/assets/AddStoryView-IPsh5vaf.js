import{U as r}from"./index-Q4aJbjSp.js";const o={mainContent:null,presenter:null,formElement:null,descriptionEl:null,cameraPreviewEl:null,capturedImageCanvasEl:null,storyPhotoDataStatusEl:null,photoFileInputEl:null,startCameraButtonEl:null,captureImageButtonEl:null,retakeImageButtonEl:null,mapPickerContainerEl:null,storyLatEl:null,storyLonEl:null,submitButtonEl:null,errorElement:null,setPresenter(e){this.presenter=e},_getAddStoryFormHTML(){return`
            <section id="add-story-page" class="page-section add-story-section animate-fade-in">
                <div class="form-card">
                    <h1 class="form-title">Buat Cerita Baru Anda</h1>
                    <form id="addStoryFormElement" class="story-form" novalidate>
                        <div class="form-group">
                            <label for="addStoryDescription" class="form-label">Deskripsi Cerita <span class="required-star">*</span></label>
                            <textarea id="addStoryDescription" name="description" rows="5" required class="form-control" placeholder="Ceritakan pengalaman menarik Anda secara detail..."></textarea>
                        </div>

                        <fieldset class="form-fieldset">
                            <legend class="fieldset-legend"><i class="fas fa-camera-retro"></i>Foto Cerita <span class="required-star">*</span></legend>
                            <div id="addStoryCameraPreviewContainer" class="camera-preview-container">
                                <video id="addStoryCameraPreview" autoplay playsinline muted class="camera-video-preview" aria-label="Pratinjau kamera"></video>
                                <canvas id="addStoryCapturedImageCanvas" class="camera-canvas-preview hidden" aria-label="Gambar yang diambil"></canvas>
                            </div>
                            <div class="camera-controls">
                                <button type="button" id="addStoryStartCameraButton" class="btn btn-secondary btn-camera"><i class="fas fa-video"></i>Mulai Kamera</button>
                                <button type="button" id="addStoryCaptureImageButton" class="btn btn-primary btn-camera" disabled><i class="fas fa-camera"></i>Ambil Gambar</button>
                                <button type="button" id="addStoryRetakeImageButton" class="btn btn-danger btn-camera hidden"><i class="fas fa-sync-alt"></i>Ambil Ulang</button>
                            </div>
                            <p class="file-input-fallback-text">Atau <label for="storyPhotoFileInput" class="file-input-label">pilih file dari galeri</label>.</p>
                            <input type="file" id="storyPhotoFileInput" class="file-input-hidden" accept="image/png, image/jpeg, image/gif">
                            <input type="hidden" id="addStoryPhotoDataStatus" name="photoDataStatus" required>
                        </fieldset>

                        <fieldset class="form-fieldset">
                            <legend class="fieldset-legend"><i class="fas fa-map-pin"></i>Tandai Lokasi di Peta (Opsional)</legend>
                            <div id="addStoryMapPickerContainer" class="map-picker-container" aria-label="Peta interaktif untuk memilih lokasi cerita"></div>
                            <p class="map-picker-help-text">Klik pada peta untuk memilih lokasi. Biarkan kosong jika tidak ingin menyertakan lokasi.</p>
                            <div class="location-inputs-grid">
                                <div class="form-group">
                                    <label for="addStoryLat" class="form-label">Latitude</label>
                                    <input type="text" id="addStoryLat" name="lat" readonly class="form-control form-control-readonly">
                                </div>
                                <div class="form-group">
                                    <label for="addStoryLon" class="form-label">Longitude</label>
                                    <input type="text" id="addStoryLon" name="lon" readonly class="form-control form-control-readonly">
                                </div>
                            </div>
                        </fieldset>
                        
                        <div id="addStoryError" class="form-error-message hidden"></div>

                        <div class="form-submit-group">
                            <button type="submit" id="addStorySubmitButton" class="btn btn-success btn-block btn-lg">
                                <span class="submit-text"><i class="fas fa-cloud-upload-alt"></i>Publikasikan Cerita</span>
                                <span class="loading-indicator hidden"><div class="spinner-inline"></div></span>
                            </button>
                        </div>
                    </form>
                </div>
            </section>
        `},renderAddStoryForm(){if(!this.mainContent){console.error("AddStoryView: mainContent element not found.");return}console.log("AddStoryView: Merender form tambah cerita..."),this.mainContent.innerHTML=this._getAddStoryFormHTML(),this._cacheDOMElements(),this._addEventListeners(),this.presenter&&typeof this.presenter.initializeExternalServices=="function"?(console.log("AddStoryView: Memanggil presenter.initializeExternalServices"),this.presenter.initializeExternalServices(this.cameraPreviewEl,this.capturedImageCanvasEl,this.mapPickerContainerEl.id)):console.error("AddStoryView: Presenter atau initializeExternalServices tidak tersedia.")},_cacheDOMElements(){console.log("AddStoryView: Caching DOM elements..."),this.formElement=document.getElementById("addStoryFormElement"),this.descriptionEl=document.getElementById("addStoryDescription"),this.cameraPreviewEl=document.getElementById("addStoryCameraPreview"),this.capturedImageCanvasEl=document.getElementById("addStoryCapturedImageCanvas"),this.storyPhotoDataStatusEl=document.getElementById("addStoryPhotoDataStatus"),this.photoFileInputEl=document.getElementById("storyPhotoFileInput"),this.startCameraButtonEl=document.getElementById("addStoryStartCameraButton"),this.captureImageButtonEl=document.getElementById("addStoryCaptureImageButton"),this.retakeImageButtonEl=document.getElementById("addStoryRetakeImageButton"),this.mapPickerContainerEl=document.getElementById("addStoryMapPickerContainer"),this.storyLatEl=document.getElementById("addStoryLat"),this.storyLonEl=document.getElementById("addStoryLon"),this.submitButtonEl=document.getElementById("addStorySubmitButton"),this.errorElement=document.getElementById("addStoryError"),console.log("AddStoryView: DOM elements cached",{form:this.formElement,cameraPreview:this.cameraPreviewEl,capturedCanvas:this.capturedImageCanvasEl})},_addEventListeners(){if(!this.formElement||!this.presenter){console.error("AddStoryView: Form atau Presenter tidak tersedia untuk menambahkan event listeners.");return}console.log("AddStoryView: Menambahkan event listeners..."),this.formElement.addEventListener("submit",e=>{e.preventDefault();const t=this.descriptionEl.value;this.presenter.handleSubmitStory(t)}),this.startCameraButtonEl&&this.startCameraButtonEl.addEventListener("click",()=>this.presenter.handleStartCamera()),this.captureImageButtonEl&&this.captureImageButtonEl.addEventListener("click",()=>this.presenter.handleCaptureImage()),this.retakeImageButtonEl&&this.retakeImageButtonEl.addEventListener("click",()=>this.presenter.handleRetakeImage()),this.photoFileInputEl&&this.photoFileInputEl.addEventListener("change",e=>{const t=e.target.files[0];t&&typeof this.presenter.handleFileSelected=="function"&&this.presenter.handleFileSelected(t)})},showCameraPreview(){console.log("AddStoryView: showCameraPreview dipanggil"),this.cameraPreviewEl?(this.cameraPreviewEl.style.display="block",console.log("AddStoryView: Video preview set to display: block")):console.error("AddStoryView: cameraPreviewEl tidak ditemukan di showCameraPreview"),this.capturedImageCanvasEl?(this.capturedImageCanvasEl.style.display="none",this.capturedImageCanvasEl.classList.add("hidden"),console.log("AddStoryView: Canvas set to display: none and class 'hidden' added")):console.error("AddStoryView: capturedImageCanvasEl tidak ditemukan di showCameraPreview")},showCapturedImage(e){if(console.log("AddStoryView: showCapturedImage dipanggil dengan data (awal):",e?e.substring(0,50)+"...":"null"),!e){console.error("AddStoryView: base64ImageData null atau undefined di showCapturedImage."),r.showMessage("Error Pratinjau","Tidak ada data gambar untuk ditampilkan.",!0);return}if(this.cameraPreviewEl?(this.cameraPreviewEl.style.display="none",console.log("AddStoryView: Video preview set to display: none")):console.error("AddStoryView: cameraPreviewEl tidak ditemukan di showCapturedImage"),this.capturedImageCanvasEl){this.capturedImageCanvasEl.classList.remove("hidden"),this.capturedImageCanvasEl.style.display="block",console.log("AddStoryView: Canvas style.display diatur ke 'block' dan kelas 'hidden' dihapus. Canvas element:",this.capturedImageCanvasEl);const t=this.capturedImageCanvasEl.getContext("2d");if(!t){console.error("AddStoryView: Gagal mendapatkan context 2D dari canvas."),r.showMessage("Error Canvas","Tidak dapat menyiapkan area pratinjau gambar.",!0);return}const a=new Image;a.onload=()=>{if(console.log("AddStoryView: Gambar (dari base64) berhasil dimuat ke objek Image.",{width:a.width,height:a.height}),a.width===0||a.height===0){console.error("AddStoryView: Dimensi gambar yang dimuat adalah 0. Tidak bisa menggambar."),r.showMessage("Error Gambar","Data gambar tidak valid atau corrupt.",!0),this.capturedImageCanvasEl.style.display="none",this.capturedImageCanvasEl.classList.add("hidden");return}let i=(this.capturedImageCanvasEl.parentElement||this.capturedImageCanvasEl).clientWidth;!i&&this.cameraPreviewEl&&this.cameraPreviewEl.parentElement&&(i=this.cameraPreviewEl.parentElement.clientWidth),i||(i=320,console.warn("AddStoryView: clientWidth container adalah 0, menggunakan default width 320px untuk canvas."));const n=a.width/a.height;this.capturedImageCanvasEl.width=i,this.capturedImageCanvasEl.height=i/n,console.log("AddStoryView: Menggambar ke canvas. Dimensi Canvas diatur ke:",this.capturedImageCanvasEl.width,"x",this.capturedImageCanvasEl.height),t.clearRect(0,0,this.capturedImageCanvasEl.width,this.capturedImageCanvasEl.height),t.drawImage(a,0,0,this.capturedImageCanvasEl.width,this.capturedImageCanvasEl.height),console.log("AddStoryView: Gambar seharusnya sudah digambar ke canvas.")},a.onerror=s=>{console.error("AddStoryView: Error saat memuat base64 ke objek Image:",s),r.showMessage("Error Gambar","Gagal memuat pratinjau gambar. Pastikan format gambar didukung.",!0),this.capturedImageCanvasEl.style.display="none",this.capturedImageCanvasEl.classList.add("hidden")},a.src=e}else console.error("AddStoryView: Elemen canvas tidak ditemukan untuk showCapturedImage.")},setStoryPhotoDataStatus(e){console.log("AddStoryView: setStoryPhotoDataStatus dipanggil, hasImage:",e),this.storyPhotoDataStatusEl&&(this.storyPhotoDataStatusEl.value=e?"image_present":"")},toggleCameraButtons(e){console.log("AddStoryView: toggleCameraButtons dipanggil dengan state:",e),this.startCameraButtonEl&&this.startCameraButtonEl.classList.toggle("hidden",e==="capturing"||e==="captured"||e==="file_selected"),this.captureImageButtonEl&&(this.captureImageButtonEl.classList.toggle("hidden",e!=="capturing"),this.captureImageButtonEl.disabled=e!=="capturing"),this.retakeImageButtonEl&&this.retakeImageButtonEl.classList.toggle("hidden",e!=="captured"&&e!=="file_selected")},updateLocationInputs(e,t){this.storyLatEl&&(this.storyLatEl.value=e!=null?e.toFixed(7):""),this.storyLonEl&&(this.storyLonEl.value=t!=null?t.toFixed(7):"")},showLoading(){if(this.submitButtonEl){this.submitButtonEl.disabled=!0;const e=this.submitButtonEl.querySelector(".submit-text"),t=this.submitButtonEl.querySelector(".loading-indicator");e&&(e.style.display="none"),t&&t.classList.remove("hidden")}},hideLoading(){if(this.submitButtonEl){this.submitButtonEl.disabled=!1;const e=this.submitButtonEl.querySelector(".submit-text"),t=this.submitButtonEl.querySelector(".loading-indicator");e&&(e.style.display="inline-block"),t&&t.classList.add("hidden")}},displayError(e){this.errorElement?(this.errorElement.textContent=e,this.errorElement.classList.remove("hidden")):r.showMessage("Error",e,!0)},clearError(){this.errorElement&&(this.errorElement.textContent="",this.errorElement.classList.add("hidden"))},clearForm(){if(this.formElement&&this.formElement.reset(),this.cameraPreviewEl&&(this.cameraPreviewEl.style.display="block"),this.capturedImageCanvasEl){this.capturedImageCanvasEl.style.display="none",this.capturedImageCanvasEl.classList.add("hidden");const e=this.capturedImageCanvasEl.getContext("2d");this.capturedImageCanvasEl.width>0&&this.capturedImageCanvasEl.height>0&&e.clearRect(0,0,this.capturedImageCanvasEl.width,this.capturedImageCanvasEl.height)}this.storyPhotoDataStatusEl&&(this.storyPhotoDataStatusEl.value=""),this.updateLocationInputs(null,null),this.toggleCameraButtons("initial"),this.clearError(),this.presenter&&typeof this.presenter.resetMapPicker=="function"&&this.presenter.resetMapPicker()},destroy(){this.mainContent&&(this.mainContent.innerHTML=""),console.log("AddStoryView dihancurkan.")}};export{o as default};
