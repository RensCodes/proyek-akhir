(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const E="modulepreload",b=function(e){return"/proyek-akhir/"+e},p={},c=function(t,r,o){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(r.map(l=>{if(l=b(l),l in p)return;p[l]=!0;const g=l.endsWith(".css"),w=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${w}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":E,g||(d.as="script"),d.crossOrigin="",d.href=l,i&&d.setAttribute("nonce",i),document.head.appendChild(d),g)return new Promise((v,S)=>{d.addEventListener("load",v),d.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return n.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})},h={performViewTransition:e=>document.startViewTransition?document.startViewTransition(e):(e(),null),showMessage:(e,t,r=!1)=>{const o=document.getElementById("messageModal"),n=document.getElementById("messageModalTitle"),s=document.getElementById("messageModalText"),a=document.getElementById("messageModalClose");if(!o||!n||!s||!a){console.error("Modal elements not found for Utils.showMessage!"),alert(`${e}: ${t}`);return}n.textContent=e,n.className=`modal-title ${r?"modal-title-error":"modal-title-success"}`,r?n.style.color="#dc3545":n.style.color="#343a40",s.textContent=t,o.classList.add("active"),a.focus();const i=a.cloneNode(!0);i.textContent="Tutup",i.className="btn btn-primary modal-close-btn",a.parentNode.replaceChild(i,a),i.addEventListener("click",()=>o.classList.remove("active"),{once:!0})},showLoadingSpinner:(e,t="Memuat...")=>{if(!e)return null;e.innerHTML="";const r=h.createElement("div",{class:"loading-indicator-container"}),o=h.createElement("div",{class:"spinner","aria-label":"Loading indicator",role:"status"}),n=h.createElement("p",{class:"loading-text"},[t]);return r.append(o,n),e.appendChild(r),r},hideLoadingSpinner:e=>{if(!e)return;const t=e.querySelector(".loading-indicator-container");t&&t.remove()},createElement:(e,t={},r=[])=>{const o=document.createElement(e);for(const n in t)o.setAttribute(n,t[n]);return r.forEach(n=>{typeof n=="string"?o.appendChild(document.createTextNode(n)):n instanceof Node&&o.appendChild(n)}),o},async base64ToFile(e,t,r){try{const n=await(await fetch(e)).blob();return new File([n],t,{type:r||n.type})}catch(o){throw console.error("Error converting base64 to File:",o),new Error("Gagal memproses gambar.")}},formatDate(e){if(!e)return"Tanggal tidak diketahui";try{return new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error(`Gagal memformat tanggal: "${e}"`,t),e}}},m={API_BASE_URL:"https://story-api.dicoding.dev/v1",TILE_LAYERS:{OpenStreetMap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},SatelitEsri:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},GelapCartoDB:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}},DEFAULT_MAP_CENTER:[-2.5489,118.0149],DEFAULT_MAP_ZOOM:5},y={async register(e){const t=await fetch(`${m.API_BASE_URL}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(t.status>=400||r.error)throw new Error(r.message||"Gagal melakukan registrasi");return r},async login(e){const t=await fetch(`${m.API_BASE_URL}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(t.status>=400||r.error)throw new Error(r.message||"Gagal melakukan login");return r.loginResult},async getStories(e){if(!e)return Promise.reject(new Error("Token tidak tersedia untuk mengambil cerita."));const t=await fetch(`${m.API_BASE_URL}/stories`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),r=await t.json();if(t.status>=400||r.error)throw new Error(r.message||"Gagal mengambil cerita");return r.listStory},async addStory(e,t){if(!e)return Promise.reject(new Error("Token tidak tersedia untuk menambah cerita."));const r=await fetch(`${m.API_BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:t}),o=await r.json();if(r.status>=400||o.error)throw new Error(o.message||"Gagal menambah cerita baru");return o},async getStoryDetail(e,t){if(!e)return Promise.reject(new Error("Token tidak tersedia."));const r=await fetch(`${m.API_BASE_URL}/stories/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),o=await r.json();if(r.status>=400||o.error)throw new Error(o.message||"Gagal mengambil detail cerita");return o.story}},_="storyAppToken",f="storyAppUserName",u={saveToken(e){localStorage.setItem(_,e)},getToken(){return localStorage.getItem(_)},removeToken(){localStorage.removeItem(_)},saveUserName(e){localStorage.setItem(f,e)},getUserName(){return localStorage.getItem(f)},removeUserName(){localStorage.removeItem(f)},isLoggedIn(){return!!this.getToken()}},P={async register(e,t,r){if(!e||!t||!r)throw new Error("Nama, email, dan password tidak boleh kosong.");if(r.length<8)throw new Error("Password minimal harus 8 karakter.");try{return await y.register({name:e,email:t,password:r})}catch(o){throw console.error("AuthModel.register error:",o),o}},async login(e,t){if(!e||!t)throw new Error("Email dan password tidak boleh kosong.");try{const r=await y.login({email:e,password:t});return u.saveToken(r.token),u.saveUserName(r.name),r}catch(r){throw console.error("AuthModel.login error:",r),u.removeToken(),u.removeUserName(),r}},logout(){u.removeToken(),u.removeUserName(),console.log("Pengguna berhasil logout dari AuthModel.")},isUserLoggedIn(){return u.isLoggedIn()},getCurrentUserName(){return u.getUserName()},getCurrentToken(){return u.getToken()}},L={_routes:{},_currentPresenter:null,_mainContentElement:null,_authModel:P,_storyModel:null,_authView:null,_homeView:null,_addStoryView:null,_savedStoriesView:null,_mapService:null,_cameraService:null,async init(e){if(this._mainContentElement=document.getElementById(e),!this._mainContentElement){console.error(`Router init: Elemen konten utama '${e}' tidak ditemukan.`);return}const{default:t}=await c(async()=>{const{default:r}=await import("./AuthView-BT9RG0Wg.js");return{default:r}},[]);this._authView=t,this._authView.mainContent=this._mainContentElement,this._routes={login:()=>this._buildAuthPresenter("login"),register:()=>this._buildAuthPresenter("register"),home:()=>this._buildHomePresenter(),"add-story":()=>this._buildAddStoryPresenter(),"saved-stories":()=>this._buildSavedStoriesPresenter(),logout:()=>this._handleLogoutRoute()},window.addEventListener("hashchange",()=>this._handleRouteChange()),this._handleRouteChange(),this._setupGlobalNavLinks(),this._updateNavbar(),window.addEventListener("online",()=>this._trySyncOutbox()),navigator.onLine&&this._trySyncOutbox()},async _loadStoryModel(){if(!this._storyModel){const{default:e}=await c(async()=>{const{default:t}=await import("./StoryModel-BVG9IzPg.js");return{default:t}},[]);this._storyModel=e}},async _loadServices(){if(!this._mapService){const{default:e}=await c(async()=>{const{default:t}=await import("./MapService-BXtTOcuq.js");return{default:t}},[]);this._mapService=e}if(!this._cameraService){const{default:e}=await c(async()=>{const{default:t}=await import("./CameraService-oUWNEs63.js");return{default:t}},[]);this._cameraService=e}},async _buildAuthPresenter(e="login"){const{default:t}=await c(async()=>{const{default:o}=await import("./AuthPresenter-CfdIpfJ1.js");return{default:o}},[]),r=t(this._authModel,this._authView,this);return e==="login"?r.showLoginPage():r.showRegisterPage(),r},async _buildHomePresenter(){if(!this._authModel.isUserLoggedIn())return this.navigateTo("login"),null;if(await this._loadStoryModel(),await this._loadServices(),!this._homeView){const{default:r}=await c(async()=>{const{default:o}=await import("./HomeView-C--D9Wr4.js");return{default:o}},[]);this._homeView=r,this._homeView.mainContent=this._mainContentElement}const{default:e}=await c(async()=>{const{default:r}=await import("./HomePresenter-ChwXqAny.js");return{default:r}},[]),t=e(this._storyModel,this._authModel,this._homeView,this,this._mapService);return await t.showStories(),t},async _buildAddStoryPresenter(){if(!this._authModel.isUserLoggedIn())return this.navigateTo("login"),null;if(await this._loadStoryModel(),await this._loadServices(),!this._addStoryView){const{default:r}=await c(async()=>{const{default:o}=await import("./AddStoryView-C1bC9fJQ.js");return{default:o}},[]);this._addStoryView=r,this._addStoryView.mainContent=this._mainContentElement}const{default:e}=await c(async()=>{const{default:r}=await import("./AddStoryPresenter-Cy-DCv_O.js");return{default:r}},[]),t=e(this._storyModel,this._addStoryView,this,this._mapService,this._cameraService,h);return t.showAddStoryForm(),t},async _buildSavedStoriesPresenter(){if(!this._authModel.isUserLoggedIn())return this.navigateTo("login"),null;if(await this._loadStoryModel(),!this._savedStoriesView){const{default:r}=await c(async()=>{const{default:o}=await import("./SavedStoriesView-DdOwFk6O.js");return{default:o}},[]);this._savedStoriesView=r,this._savedStoriesView.mainContent=this._mainContentElement}const{default:e}=await c(async()=>{const{default:r}=await import("./SavedStoriesPresenter-CEEJ1K67.js");return{default:r}},[]),t=e(this._storyModel,this._savedStoriesView,this,h);return await t.showSavedStories(),t},_buildNotFoundPresenter(){if(this._mainContentElement){this._mainContentElement.innerHTML='<section class="error-page-container"><h1 class="error-title-404">404</h1><h2 class="section-title">Halaman Tidak Ditemukan</h2><p class="error-message">Maaf, halaman yang Anda cari tidak ada.</p><a href="#" class="btn btn-primary back-to-home-btn" data-route="home">Kembali ke Beranda</a></section>';const e=this._mainContentElement.querySelector(".back-to-home-btn");e&&e.addEventListener("click",t=>{t.preventDefault(),this.navigateTo("home")})}return{destroy:()=>console.log("NotFoundPresenter destroyed.")}},_handleLogoutRoute(){var e;return(e=this._currentPresenter)!=null&&e.destroy&&this._currentPresenter.destroy(),this._currentPresenter=null,this._authModel.logout(),h.showMessage("Logout Berhasil","Anda telah berhasil keluar."),this.navigateTo("login"),null},async _handleRouteChange(){var i,l;const e=window.location.hash.slice(1)||(this._authModel.isUserLoggedIn()?"home":"login");let t=e.split("/")[0];const r=e.split("/").slice(1),o=["home","add-story","saved-stories"],n=["login","register"];if(o.includes(t)&&!this._authModel.isUserLoggedIn()){this.navigateTo("login");return}if(n.includes(t)&&this._authModel.isUserLoggedIn()){this.navigateTo("home");return}(i=this._currentPresenter)!=null&&i.destroy&&this._currentPresenter.destroy(),this._currentPresenter=null;const s=this._routes[t],a=async()=>{typeof s=="function"?this._currentPresenter=await s(r):(this._currentPresenter=this._buildNotFoundPresenter(),this._updateActiveNavLink(""))};document.startViewTransition?await document.startViewTransition(a):await a(),this._updateNavbar(),(l=this._mainContentElement)!=null&&l.focus&&this._mainContentElement.focus()},navigateTo(e){window.location.hash.slice(1).split("/")[0]!==e||window.location.hash.slice(1)!==e?window.location.hash=e:this._handleRouteChange()},_setupGlobalNavLinks(){const e=document.querySelector("#app-header .nav-container");e&&e.addEventListener("click",t=>{const r=t.target.closest("a[data-route]");r&&(t.preventDefault(),this.navigateTo(r.dataset.route))})},_updateActiveNavLink(e){document.querySelectorAll("#nav-links-container .nav-link").forEach(t=>{t.classList.toggle("active",t.dataset.route===e)})},_updateNavbar(){const e=document.getElementById("nav-links-container");if(!e)return;const t=this._authModel.isUserLoggedIn(),r=this._authModel.getCurrentUserName();let o="";t?o=`<li><a href="#home" class="nav-link" data-route="home"><i class="fas fa-home"></i> Beranda</a></li><li><a href="#add-story" class="nav-link" data-route="add-story"><i class="fas fa-plus-circle"></i> Tambah</a></li><li><a href="#saved-stories" class="nav-link" data-route="saved-stories"><i class="fas fa-save"></i> Tersimpan</a></li><li><a href="#logout" class="nav-link" data-route="logout"><i class="fas fa-sign-out-alt"></i> Logout (${r||"User"})</a></li>`:o='<li><a href="#login" class="nav-link" data-route="login"><i class="fas fa-sign-in-alt"></i> Login</a></li><li><a href="#register" class="nav-link" data-route="register"><i class="fas fa-user-plus"></i> Register</a></li>',e.innerHTML=o;const n=window.location.hash.slice(1)||(t?"home":"login");this._updateActiveNavLink(n.split("/")[0])},async _trySyncOutbox(){if(!(!this._authModel.isUserLoggedIn()||!navigator.onLine)){console.log("Router: Mencoba sinkronisasi outbox..."),await this._loadStoryModel();try{const e=await this._storyModel.syncOutboxStories();e.synced>0&&(h.showMessage("Sinkronisasi Selesai",`${e.synced} cerita dari outbox berhasil diunggah.`),window.location.hash.includes("home")&&this.navigateTo("home"))}catch(e){console.error("Router: Gagal menjalankan sinkronisasi outbox otomatis:",e)}}}};async function k(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/proyek-akhir/service-worker.js",{scope:"/proyek-akhir/"});console.log("✅ Service Worker registered:",e.scope),e.active&&T(e)}catch(e){console.error("❌ Failed to register Service Worker:",e)}}async function T(e){if(!("PushManager"in window)||await Notification.requestPermission()!=="granted")return;const r=m.VAPID_PUBLIC_KEY,o=A(r);try{const n=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o});console.log("✅ User subscribed to push:",n)}catch(n){console.error("❌ Failed to subscribe user:",n)}}function A(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(r);return Uint8Array.from([...o].map(n=>n.charCodeAt(0)))}document.addEventListener("DOMContentLoaded",()=>{L.init("main-content"),k()});export{m as C,y as S,u as T,h as U};
