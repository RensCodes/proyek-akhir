function _(d,s,l,h,n,c){const o={_storyModel:d,_addStoryView:s,_router:l,_mapService:h,_cameraService:n,_utils:c,_capturedImageData:null,_selectedLat:null,_selectedLon:null,_isCameraActive:!1,showAddStoryForm(){this._addStoryView.clearForm(),this._addStoryView.renderAddStoryForm()},initializeExternalServices(e,a,t){this._cameraService.setElements(e,a),this._mapService.initPickerMap(t,(r,i)=>{this._selectedLat=r,this._selectedLon=i,this._addStoryView.updateLocationInputs(r,i)})},async handleStartCamera(){this._addStoryView.clearError(),await this._cameraService.startCamera()?(this._isCameraActive=!0,this._addStoryView.toggleCameraButtons("capturing"),this._addStoryView.showCameraPreview()):this._addStoryView.displayError("Gagal memulai kamera. Pastikan izin telah diberikan.")},handleCaptureImage(){if(this._addStoryView.clearError(),!this._isCameraActive){this._addStoryView.displayError("Kamera belum aktif. Klik 'Mulai Kamera' dahulu.");return}const e=this._cameraService.captureImage();e?(this._capturedImageData=e,this._addStoryView.setStoryPhotoDataStatus(!0),this._addStoryView.toggleCameraButtons("captured"),this._addStoryView.showCapturedImage(e),this._isCameraActive=!1):(this._addStoryView.displayError("Gagal mengambil gambar dari kamera."),this._addStoryView.toggleCameraButtons("initial"))},handleRetakeImage(){this._addStoryView.clearError(),this._cameraService.stopCamera(),this._capturedImageData=null,this._addStoryView.setStoryPhotoDataStatus(!1),this._addStoryView.toggleCameraButtons("initial"),this._addStoryView.showCameraPreview(),this._isCameraActive=!1},async handleFileSelected(e){if(this._addStoryView.clearError(),e&&e.type.startsWith("image/")){this._cameraService.stopCamera(),this._isCameraActive=!1;try{const a=await this._convertFileToBase64(e);this._capturedImageData=a,this._addStoryView.setStoryPhotoDataStatus(!0),this._addStoryView.toggleCameraButtons("file_selected"),this._addStoryView.showCapturedImage(a)}catch(a){console.error("Error converting file to base64:",a),this._addStoryView.displayError("Gagal memproses file gambar."),this._capturedImageData=null,this._addStoryView.setStoryPhotoDataStatus(!1),this._addStoryView.toggleCameraButtons("initial")}}else e&&this._addStoryView.displayError("Format file tidak didukung. Harap pilih file gambar (PNG, JPG, GIF).")},_convertFileToBase64(e){return new Promise((a,t)=>{const r=new FileReader;r.onload=()=>a(r.result),r.onerror=i=>t(i),r.readAsDataURL(e)})},async handleSubmitStory(e){if(this._addStoryView.clearError(),!e.trim()){this._addStoryView.displayError("Deskripsi cerita tidak boleh kosong.");return}if(!this._capturedImageData){this._addStoryView.displayError("Foto cerita wajib diunggah atau diambil.");return}let a;try{if(typeof this._capturedImageData=="string"&&this._capturedImageData.startsWith("data:image")){const t=`story-${Date.now()}.jpg`,r=this._capturedImageData.substring(this._capturedImageData.indexOf(":")+1,this._capturedImageData.indexOf(";"));a=await this._utils.base64ToFile(this._capturedImageData,t,r)}else{this._addStoryView.displayError("Data gambar tidak valid untuk diunggah.");return}}catch(t){console.error("Error converting base64 to file:",t),this._addStoryView.displayError("Gagal memproses data gambar.");return}this._addStoryView.showLoading();try{const t=this._selectedLat!==null?parseFloat(this._selectedLat):null,r=this._selectedLon!==null?parseFloat(this._selectedLon):null;await this._storyModel.addNewStory(e,a,t,r),this._addStoryView.hideLoading(),this._utils.showMessage("Sukses","Cerita baru berhasil dipublikasikan!"),this._router.navigateTo("home")}catch(t){this._addStoryView.hideLoading(),this._addStoryView.displayError(t.message||"Gagal mempublikasikan cerita. Coba lagi."),console.error("AddStoryPresenter.handleSubmitStory error:",t)}},resetMapPicker(){this._mapService&&typeof this._mapService.destroyPickerMap=="function"&&this._mapService.destroyPickerMap()},destroy(){this._addStoryView&&typeof this._addStoryView.destroy=="function"&&this._addStoryView.destroy(),this._cameraService.stopCamera(),this._mapService.destroyPickerMap(),this._capturedImageData=null,this._selectedLat=null,this._selectedLon=null,this._storyModel=null,this._addStoryView=null,this._router=null,this._mapService=null,this._cameraService=null,this._utils=null,console.log("AddStoryPresenter instance (dari factory) dihancurkan.")}};return s.setPresenter(o),o}export{_ as default};
